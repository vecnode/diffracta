<UserControl
    x:Class="TimelineControl.Utils_TimelineEditor"
    xmlns="https://github.com/avaloniaui"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="clr-namespace:TimelineControl"
    MinHeight="220" MinWidth="400">
    
  <Grid RowDefinitions="Auto,Auto,*,Auto" ColumnDefinitions="*">
  <!-- ───────────────────────────────────────────────────────────────────────────── -->
   <!-- TOP BAR -->
  
    <ScrollViewer Grid.Row="0" HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Disabled">
      <StackPanel Orientation="Vertical">
        <!-- TOP BAR -->
        <Border Margin="2,2"
                Background="#8F473B"
                Height="32"
                VerticalAlignment="Center"
                Padding="4,0">
          <StackPanel Orientation="Horizontal" 
                      Spacing="6" 
                      VerticalAlignment="Center">
            
            <TextBlock
              Text="Timeline"
              VerticalAlignment="Center"
              Margin="0"
              Foreground="White"
              FontSize="10"/>
          </StackPanel>
        </Border>
        
        <!-- TOP BAR CONTROLS -->
        <Border Margin="2,2"
                Background="#8F473B"
                Height="32"
                VerticalAlignment="Center"
                Padding="4,0">
          <StackPanel Orientation="Horizontal" 
                      Spacing="6" 
                      VerticalAlignment="Center">
            
            <CheckBox
              Content="Snap"
              VerticalAlignment="Center"
              Margin="0"
              Foreground="White"
              FontSize="10"
              IsChecked="{Binding SnapEnabled, RelativeSource={RelativeSource AncestorType=local:Utils_TimelineEditor}}"/>
            
            <Button Content="+"
                    VerticalAlignment="Center"
                    Background="#d3d3d3"
                    Foreground="Black"
                    FontSize="14"
                    Click="OnAddTrackClick"
                    ToolTip.Tip="Add new track"/>
            
            <Button Content="▶"
                    VerticalAlignment="Center"
                    Background="#d3d3d3"
                    Foreground="Black"
                    FontSize="12"
                    Width="28"
                    Click="OnPlayClick"
                    ToolTip.Tip="Play timeline"/>
            
            <Button Content="⏸"
                    VerticalAlignment="Center"
                    Background="#d3d3d3"
                    Foreground="Black"
                    FontSize="12"
                    Width="28"
                    Click="OnStopClick"
                    ToolTip.Tip="Stop timeline"/>
            
            <Button Content="⏮"
                    VerticalAlignment="Center"
                    Background="#d3d3d3"
                    Foreground="Black"
                    FontSize="12"
                    Width="28"
                    Click="OnBeginningClick"
                    ToolTip.Tip="Go to beginning"/>
            
            <Button Content="⏭"
                    VerticalAlignment="Center"
                    Background="#d3d3d3"
                    Foreground="Black"
                    FontSize="12"
                    Width="28"
                    Click="OnEndClick"
                    ToolTip.Tip="Go to end"/>
          </StackPanel>
        </Border>
      </StackPanel>
    </ScrollViewer>


    <!-- CLIPS OVERVIEW BAR
    <local:TimelineRuler
      Grid.Row="1"
      Height="16"
      Zoom="{Binding Zoom, RelativeSource={RelativeSource AncestorType=local:Utils_TimelineEditor}}"
      Duration="{Binding Duration, RelativeSource={RelativeSource AncestorType=local:Utils_TimelineEditor}}"
      CursorTime="{Binding CursorTime, RelativeSource={RelativeSource AncestorType=local:Utils_TimelineEditor}}"
      ShowClips="True"
      Tracks="{Binding Tracks, RelativeSource={RelativeSource AncestorType=local:Utils_TimelineEditor}}"/>
    -->


    <!-- MAIN RULER AND CANVAS WRAPPED IN BORDER -->
    <Border Grid.Row="1" Grid.RowSpan="2"
            Background="Blue"
            BorderBrush="Green"
            BorderThickness="1"
            Margin="2"
            HorizontalAlignment="Left"
            ClipToBounds="True">
      <Grid RowDefinitions="Auto,*" ColumnDefinitions="160,*" ClipToBounds="True">
        
        <!-- LEFT SIDEBAR (TRACK HEAD) -->
        <Grid Grid.Row="0" Grid.RowSpan="2"
              Grid.Column="0"
              RowDefinitions="24,*"
              Width="160"
              Background="#3B3B3B"
              ClipToBounds="True">
          <!-- TOP BAR -->
          <Border Grid.Row="0"
                  Background="Pink"
                  BorderBrush="Purple"
                  BorderThickness="1"/>
          
          <!-- TRACK HEADS SCROLLER (synced with main canvas) -->
          <ScrollViewer Grid.Row="1"
                        Name="PART_TrackHeadScroller"
                        HorizontalScrollBarVisibility="Disabled"
                        VerticalScrollBarVisibility="Hidden"
                        Background="#3B3B3B"
                        ClipToBounds="True">
            <local:TimelineTrackHead
              Name="PART_TrackHead"
              Tracks="{Binding Tracks, RelativeSource={RelativeSource AncestorType=local:Utils_TimelineEditor}}"/>
          </ScrollViewer>
        </Grid>
        
        <!-- MAIN RULER -->
        <local:TimelineRuler
          Grid.Row="0"
          Grid.Column="1"
          Height="24"
          ClipToBounds="True"
          Zoom="{Binding Zoom, RelativeSource={RelativeSource AncestorType=local:Utils_TimelineEditor}}"
          Duration="{Binding Duration, RelativeSource={RelativeSource AncestorType=local:Utils_TimelineEditor}}"
          CursorTime="{Binding CursorTime, RelativeSource={RelativeSource AncestorType=local:Utils_TimelineEditor}}"/>

        <!-- MAIN SCROLLABLE CANVAS -->
        <ScrollViewer
          Grid.Row="1"
          Grid.Column="1"
          Name="PART_Scroller"
          HorizontalScrollBarVisibility="Auto"
          VerticalScrollBarVisibility="Auto"
          Background="#111"
          ClipToBounds="True">
          <local:TimelineCanvas
            Name="PART_Canvas"
            Focusable="True"
            Zoom="{Binding Zoom, RelativeSource={RelativeSource AncestorType=local:Utils_TimelineEditor}}"
            Duration="{Binding Duration, RelativeSource={RelativeSource AncestorType=local:Utils_TimelineEditor}}"
            Tracks="{Binding Tracks, RelativeSource={RelativeSource AncestorType=local:Utils_TimelineEditor}}"
            CursorTime="{Binding CursorTime, RelativeSource={RelativeSource AncestorType=local:Utils_TimelineEditor}, Mode=TwoWay}"
            SnapEnabled="{Binding SnapEnabled, RelativeSource={RelativeSource AncestorType=local:Utils_TimelineEditor}}"/>
        </ScrollViewer>
      </Grid>
    </Border>
    
    <!-- ───────────────────────────────────────────────────────────────────────────── -->
    <!-- BOTTOM BAR -->
    <ScrollViewer Grid.Row="3" HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Disabled">
      
      <!-- BOTTOM BAR CONTROLS -->
      <Border Margin="2,2"
              Background="#8F473B"
              Height="32"
              VerticalAlignment="Center"
              Padding="4,0">
        <StackPanel Orientation="Horizontal" 
                    Spacing="6" 
                    VerticalAlignment="Center">
          
          <Button Content="&lt;"
                  Width="32"
                  VerticalAlignment="Center"
                  Margin="0"
                  Foreground="White"
                  FontSize="12"
                  Click="OnResetCursorClick"
                  ToolTip.Tip="Reset cursor to start"/>
          
          <Button Content="( )"
                  Width="32"
                  VerticalAlignment="Center"
                  Margin="8,0,0,0"
                  Foreground="White"
                  FontSize="12"
                  Click="OnFitZoomClick"
                  ToolTip.Tip="Fit zoom to all tracks"/>
          
          <Border BorderBrush="Black"
                  BorderThickness="1"
                  VerticalAlignment="Center"
                  Margin="16,0,0,0"
                  Padding="4,2">
            <StackPanel Orientation="Horizontal" 
                        Spacing="4" 
                        VerticalAlignment="Center">
              <TextBlock Text="Zoom" VerticalAlignment="Center" Foreground="White" FontSize="10"/>
              
              <Slider
                Minimum="20" Maximum="400"
                Width="160"
                VerticalAlignment="Center"
                Value="{Binding Zoom, RelativeSource={RelativeSource AncestorType=local:Utils_TimelineEditor}}"/>
                
              <TextBlock
                VerticalAlignment="Center"
                Foreground="White"
                FontSize="10"
                Text="{Binding Zoom, RelativeSource={RelativeSource AncestorType=local:Utils_TimelineEditor}, StringFormat={}{0:0} px/s}"/>
            </StackPanel>
          </Border>
        </StackPanel>
      </Border>
    </ScrollViewer>
    
  </Grid>
</UserControl>


