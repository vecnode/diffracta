<?xml version="1.0" encoding="utf-8"?>
<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="using:Diffracta"
        xmlns:gfx="using:Diffracta.Graphics"
        x:Class="Diffracta.MainWindow"
        x:DataType="local:MainWindow"
        Width="1280" Height="800" Title="Diffracta (v0.1) 720p MainWindow">
  

  <Window.Styles>
    <StyleInclude Source="avares://Diffracta/Utils/Utils_Slider.axaml"/>
    <StyleInclude Source="avares://Diffracta/Utils/Utils_Button.axaml"/>
    <StyleInclude Source="avares://Diffracta/Utils/Utils_MenuBar.axaml"/>
    
    <Style Selector="TextBox#LogTextBox">
      <Setter Property="Background" Value="Transparent"/>
      <Setter Property="Foreground" Value="White"/>
      <Setter Property="BorderThickness" Value="0"/>
      <Setter Property="Focusable" Value="False"/>
      <Setter Property="Cursor" Value="Arrow"/>
    </Style>
    
    <!-- TabItem styling - reduce header height and remove underline -->
    <Style Selector="TabItem">
      <Setter Property="MinHeight" Value="26"/>
      <Setter Property="Padding" Value="8,4"/>
      <Setter Property="BorderThickness" Value="0"/>
    </Style>
    <!-- Remove underline from selected tab -->
    <Style Selector="TabItem:selected /template/ Border#PART_SelectedPipe">
        <Setter Property="IsVisible" Value="false"/>
    </Style>

  </Window.Styles>
  
  <Grid Background="#1e1e1e">
    <Grid.RowDefinitions>
        <RowDefinition Height="Auto"/>
        <RowDefinition Height="Auto"/>
        <RowDefinition Height="*"/>
        <RowDefinition Height="3*"/>
    </Grid.RowDefinitions>
    
    <Grid.ColumnDefinitions>
        <ColumnDefinition Width="200"/>
        <ColumnDefinition Width="Auto"/>
        <ColumnDefinition Width="2.5*"/>
        <ColumnDefinition Width="*"/>
    </Grid.ColumnDefinitions>
    
    <!-- Left Sidebar -->
    <Border x:Name="LeftSidebar" Grid.Row="2" Grid.RowSpan="2" Grid.Column="0" 
            Background="#1e1e1e"
            BorderBrush="#555555"
            BorderThickness="1,0,1,1">
        <!-- Content will be added here -->
    </Border>
    
    <!-- Menu Bar -->
    <Menu x:Name="MenuBar" Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="4" Background="#2d2d2d" Foreground="White" FontSize="12">
        <MenuItem Header="_File">
            <MenuItem Header="_New" />
            <MenuItem Header="E_xit" />
        </MenuItem>
        <MenuItem Header="_View">
            <MenuItem Header="Toggle Performance Mode" />
            <MenuItem Header="Toggle Child Window 1" x:Name="ChildWindow1MenuItem" />
            <MenuItem Header="Toggle Child Window 2" x:Name="ChildWindow2MenuItem" />
        </MenuItem>
        <MenuItem Header="_Help">
            <MenuItem Header="_About" />
            <MenuItem Header="Documentation" />
        </MenuItem>
    </Menu>
    
    <!-- Top toolbar -->
    <Border Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="4" 
            Background="#1e1e1e"
            BorderBrush="#555555"
            BorderThickness="1,1,1,1"
            Margin="0">
      <StackPanel x:Name="TopToolbar" Orientation="Horizontal" Spacing="8" Margin="8">
        <Button x:Name="PerformanceButton" Content="Performance" Margin="0,0,0,0" />
        <Button x:Name="LogsButton" Content="Logs" Margin="0,0,0,0" />
      </StackPanel>
    </Border>
    
    
    
    <!-- Page Selector Bar -->
    <Border x:Name="PageSelectorBar" Grid.Row="2" Grid.RowSpan="2" Grid.Column="1" 
            Width="52" 
            Background="#1e1e1e"
            BorderBrush="#555555"
            BorderThickness="0,0,1,1">
        <StackPanel Orientation="Vertical" Spacing="0" Margin="0">
            <!-- Button 1: Controls -->
            <Button x:Name="Page1Button" Width="51" Height="27.2" 
                    Background="Transparent" 
                    BorderThickness="1"
                    BorderBrush="#555555"
                    CornerRadius="0">
                <TextBlock Text="1" 
                           Foreground="White" 
                           FontSize="10"
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center"/>
                <Button.Styles>
                    <Style Selector="Button:pointerover">
                        <Setter Property="Background" Value="#2d2d2d"/>
                    </Style>
                </Button.Styles>
            </Button>
            
            <!-- Button 2: Tools -->
            <Button x:Name="Page2Button" Width="51" Height="27.2" 
                    Background="Transparent" 
                    BorderThickness="1"
                    BorderBrush="#555555"
                    CornerRadius="0">
                <TextBlock Text="2" 
                           Foreground="White" 
                           FontSize="10"
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center"/>
                <Button.Styles>
                    <Style Selector="Button:pointerover">
                        <Setter Property="Background" Value="#2d2d2d"/>
                    </Style>
                </Button.Styles>
            </Button>
            
            <!-- Button 3: Settings -->
            <Button x:Name="Page3Button" Width="51" Height="27.2" 
                    Background="Transparent" 
                    BorderThickness="1"
                    BorderBrush="#555555"
                    CornerRadius="0">
                <TextBlock Text="3" 
                           Foreground="White" 
                           FontSize="10"
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center"/>
                <Button.Styles>
                    <Style Selector="Button:pointerover">
                        <Setter Property="Background" Value="#2d2d2d"/>
                    </Style>
                </Button.Styles>
            </Button>

            <!-- Button 4: Help -->
            <Button x:Name="Page4Button" Width="51" Height="27.2" 
                    Background="Transparent" 
                    BorderThickness="1"
                    BorderBrush="#555555"
                    CornerRadius="0">
                <TextBlock Text="4" 
                           Foreground="White" 
                           FontSize="10"
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center"/>
                <Button.Styles>
                    <Style Selector="Button:pointerover">
                        <Setter Property="Background" Value="#2d2d2d"/>
                    </Style>
                </Button.Styles>
            </Button>
        </StackPanel>
    </Border>
    
    
    
    <!-- Left Panel (Page-based Navigation) - Full Height -->
    <Grid Grid.Row="2" Grid.RowSpan="2" Grid.Column="2" x:Name="ControlsPanel" Background="#2d2d2d">
        <ContentControl x:Name="PageContentControl">
            <!-- Page content will be swapped dynamically -->
        </ContentControl>
    </Grid>
    
    <!-- Vertical splitter between left and right columns -->
    <GridSplitter Grid.Row="2" Grid.RowSpan="2" Grid.Column="2" Width="1" Background="#555555" HorizontalAlignment="Right" x:Name="VerticalSplitter"/>
    

    
    <!-- Right Side Panel: Shader Surface and Tabbed Panel -->
    <Grid Grid.Row="2" Grid.RowSpan="2" Grid.Column="3" x:Name="TopRightPanel" Background="#2d2d2d" MinWidth="200">
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="3"/>
            <RowDefinition Height="3*"/>
        </Grid.RowDefinitions>
        
        <!-- Top Right: Shader Surface -->
        <Border Grid.Row="0"
                BorderBrush="Pink" 
                BorderThickness="1" 
                HorizontalAlignment="Stretch" 
                VerticalAlignment="Stretch"
                Padding="6"
                Margin="0,0,0,2"
                ClipToBounds="True">
            <Border HorizontalAlignment="Left" 
                    VerticalAlignment="Top"
                    Width="202"
                    Height="114"
                    BorderBrush="#555555" 
                    BorderThickness="1"
                    ClipToBounds="True">
                <gfx:ShaderSurface x:Name="Surface" 
                                  Width="200"
                                  Height="112"
                                  Margin="0" 
                                  Focusable="True" 
                                  ClipToBounds="True" 
                                  HorizontalAlignment="Stretch" 
                                  VerticalAlignment="Stretch"/>
            </Border>
        </Border>
        
        <!-- Horizontal splitter between top and bottom rows -->
        <GridSplitter Grid.Row="1" Height="1" Background="#555555" x:Name="HorizontalSplitter"/>
        
        <!-- Bottom Right: Tabbed Panel -->
        <Grid Grid.Row="2" Background="#2d2d2d">
            <TabControl Background="#2d2d2d" Foreground="White">

            <TabItem Header="Global" Background="#1e1e1e" FontSize="14" Foreground="White"> 

                <Border BorderBrush="Pink" BorderThickness="1" Background="#2d2d2d" Margin="-10, 0, -10, 0" HorizontalAlignment="Stretch" VerticalAlignment="Stretch">

                    <ScrollViewer Margin="0" HorizontalAlignment="Stretch" VerticalAlignment="Stretch">
                        <StackPanel Spacing="0" HorizontalAlignment="Stretch" VerticalAlignment="Stretch">


                            <!-- Shader Nodes Visualization - Processing Layers -->
                            <local:Utils_NodesListBox x:Name="NodesListBox"/>
                            
                            <ProgressBar x:Name="GlobalProgressBar" 
                                         Height="20" 
                                         Minimum="0" 
                                         Maximum="100" 
                                         Value="0"
                                         ShowProgressText="True"
                                         Foreground="#ff8c00"
                                         FontSize="12"
                                         CornerRadius="0"/>

                            
                        </StackPanel>
                    </ScrollViewer>
                </Border>
            </TabItem>
            <TabItem Header="MIDI" Background="#1e1e1e" FontSize="14" Foreground="White"> 
                <Border BorderBrush="Pink" BorderThickness="1" Background="#2d2d2d" Margin="-10, 0, -10, 0" HorizontalAlignment="Stretch" VerticalAlignment="Stretch">
                    <ScrollViewer Margin="0" HorizontalAlignment="Stretch" VerticalAlignment="Stretch">
                        <StackPanel Spacing="0" HorizontalAlignment="Stretch" VerticalAlignment="Stretch">

                            <!-- MIDI Devices Box -->
                            <Border BorderBrush="Black" BorderThickness="1" Padding="4">
                                <StackPanel Spacing="6">
                                    <TextBlock Text="MIDI Devices" Foreground="White" FontSize="12"/>
                                    <ListBox x:Name="MidiDevicesList"
                                             Height="100"
                                             Background="DarkGray"
                                             Foreground="Black"
                                             BorderBrush="Black"
                                             BorderThickness="1"
                                             CornerRadius="0">
                                        <ListBox.Styles>
                                            <Style Selector="ListBoxItem">
                                                <Setter Property="Height" Value="20"/>
                                                <Setter Property="Padding" Value="4,0"/>
                                            </Style>
                                        </ListBox.Styles>
                                        <ListBox.ItemTemplate>
                                            <DataTemplate>
                                                <TextBlock Text="{Binding}"
                                                           VerticalAlignment="Center"
                                                           HorizontalAlignment="Left"
                                                           TextTrimming="CharacterEllipsis"/>
                                            </DataTemplate>
                                        </ListBox.ItemTemplate>
                                    </ListBox>
                                    <TextBlock Text="Incoming MIDI" Foreground="White" FontSize="12"/>
                                    <ListBox x:Name="MidiInEventsList"
                                             Height="100"
                                             Background="DarkGray"
                                             Foreground="Black"
                                             BorderBrush="Black"
                                             BorderThickness="1"
                                             CornerRadius="0">
                                        <ListBox.Styles>
                                            <Style Selector="ListBoxItem">
                                                <Setter Property="Height" Value="20"/>
                                                <Setter Property="Padding" Value="4,0"/>
                                            </Style>
                                        </ListBox.Styles>
                                        <ListBox.ItemTemplate>
                                            <DataTemplate>
                                                <TextBlock Text="{Binding}"
                                                           VerticalAlignment="Center"
                                                           HorizontalAlignment="Left"
                                                           TextTrimming="CharacterEllipsis"/>
                                            </DataTemplate>
                                        </ListBox.ItemTemplate>
                                    </ListBox>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </ScrollViewer>
                </Border>
            </TabItem>


        </TabControl>
        </Grid>
    </Grid>
    
    <!-- Bottom Log Popup Panel -->
    <Border x:Name="LogPopupPanel" 
            Grid.RowSpan="4" 
            Grid.ColumnSpan="4"
            Background="#2d2d2d" 
            BorderBrush="#555555"
            BorderThickness="0,2,0,0"
            IsVisible="False"
            VerticalAlignment="Bottom"
            Height="220"
            ClipToBounds="False">
        <Grid Background="#1e1e1e">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            
            <StackPanel Orientation="Horizontal" Spacing="8" Margin="8,4" Grid.Row="0">
                <Button x:Name="ClearLogButton" Content="Clear" Width="60" Height="30" FontSize="12"/>
                <Button x:Name="CopyLogButton" Content="Copy" Width="60" Height="30" FontSize="12"/>
            </StackPanel>
            
            <ScrollViewer Grid.Row="1" Margin="8,0,8,8" x:Name="LogScrollViewer">
                <TextBlock x:Name="LogTextBox" 
                           Background="Transparent" 
                           Foreground="White" 
                           TextWrapping="Wrap"
                           FontSize="10"/>
            </ScrollViewer>
        </Grid>
    </Border>
  </Grid>
</Window>
